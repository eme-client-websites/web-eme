---
import { languages, getLangFromUrl } from '../i18n/utils';

const currentLang = getLangFromUrl(Astro.url);
const otherLang = currentLang === 'es' ? 'en' : 'es';

// Construir la URL para el otro idioma
function getOtherLangUrl() {
  const pathname = Astro.url.pathname;
  
  if (currentLang === 'es') {
    // Si estamos en español, agregar /en al inicio
    return '/en' + pathname;
  } else {
    // Si estamos en inglés, quitar /en del inicio
    return pathname.replace('/en', '') || '/';
  }
}

const otherLangUrl = getOtherLangUrl();
---

<div class="relative inline-block">
  <button 
    id="language-toggle"
    class="flex items-center space-x-2 text-white hover:text-[#0043FF] transition-colors duration-200 px-3 py-2 rounded-md text-sm font-medium"
    aria-label="Change language"
  >
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
    </svg>
    <span class="uppercase font-semibold">{currentLang}</span>
    <svg class="w-3 h-3 transition-transform duration-200" id="chevron" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
    </svg>
  </button>
  
  <div 
    id="language-dropdown" 
    class="absolute right-0 mt-2 w-32 backdrop-blur-md border border-white/20 rounded-md shadow-lg opacity-0 invisible transition-all duration-200 z-50"
    style="background-color: rgba(0, 51, 196, 0.9);"
  >
    <a 
      href={otherLangUrl}
      class="block px-4 py-2 text-sm text-white hover:bg-[#0043FF]/20 hover:text-[#0043FF] transition-colors rounded-md"
    >
      <div class="flex items-center space-x-2">
        <span class="uppercase font-semibold">{otherLang}</span>
        <span class="text-xs text-gray-300">{languages[otherLang]}</span>
      </div>
    </a>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('language-toggle');
    const dropdown = document.getElementById('language-dropdown');
    const chevron = document.getElementById('chevron');
    
    if (toggle && dropdown && chevron) {
      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isVisible = !dropdown.classList.contains('opacity-0');
        
        if (isVisible) {
          dropdown.classList.add('opacity-0', 'invisible');
          chevron.style.transform = 'rotate(0deg)';
        } else {
          dropdown.classList.remove('opacity-0', 'invisible');
          chevron.style.transform = 'rotate(180deg)';
        }
      });
      
      // Cerrar al hacer clic fuera
      document.addEventListener('click', () => {
        dropdown.classList.add('opacity-0', 'invisible');
        chevron.style.transform = 'rotate(0deg)';
      });
    }
  });
</script>

<style>
  #language-dropdown {
    transform-origin: top right;
  }
</style>
